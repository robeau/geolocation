<!DOCTYPE html>
<html>
<head>
    <style type="text/css">
        html, body, #map-canvas { height: 100%; margin: 0; padding: 0;}
    </style>
    <script type="text/javascript"
            src="https://maps.googleapis.com/maps/api/js?v=3.exp">
    </script>
    <script type="text/javascript">

        var myPath = [];
        var watchID;
        var geoLoc = navigator.geolocation;
        var map;
        var marker;

        function loadMyPosition() {
            // get the geolocation
            // if the geolocation call is successful, show the map OR call the initialize function
            geoLoc.getCurrentPosition(function (position) {
                initialize(position.coords.latitude, position.coords.longitude);
            }, function (err) {
                console.log('Could not get the position object ... ', err);
            });
        }

        function getPosition(){
            geoLoc.getCurrentPosition(function (position) {
                watchID = geoLoc.watchPosition(updatePosition);
            })
        }

        function updatePosition(position){
            marker.setMap(null);
            var lat = position.coords.latitude;
            var lng = position.coords.longitude;
            var newLatLng = new google.maps.LatLng(lat,lng);
            myPath.push(newLatLng);

            console.log('position',lat,lng);
            marker = new google.maps.Marker({
                position: { lat: lat, lng: lng},
                map: map,
                title: 'Hello World!'
            });

            var flightPath = new google.maps.Polyline({
                path: myPath,
                geodesic: true,
                strokeColor: '#FF0000',
                strokeOpacity: 1.0,
                strokeWeight: 2
            });

            flightPath.setMap(map);

        }

        function initialize(lat, lng) {
            var mapOptions = {
                center: { lat: lat, lng: lng},
                zoom: 14
            };
            var div = document.getElementById('map-canvas');
            map = new google.maps.Map( div,
                    mapOptions);


            console.log('map in init',map);

            marker = new google.maps.Marker({
                map: map,
                position: new google.maps.LatLng(lat, lng),
                title:"Hello World!"
            });
            setInterval(getPosition(map), 5000);
        }

        google.maps.event.addDomListener(window, 'load', loadMyPosition);

        // todo: Write an application that uses watchPosition and google maps polylines to print the
        // path that you take on a trip


    </script>
</head>
<body>
<div id="map-canvas"></div>
</body>
</html>